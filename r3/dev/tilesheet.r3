| test de tileset
| PHREDA 2020
|MEM $ffff

^r3/lib/gui.r3
^r3/lib/btn.r3
^r3/lib/sprite.r3
^r3/util/loadimg.r3

^media/ico/tool16.ico

#testmap (
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
1 2 2 3 3 3 3 4 4 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 3 4 4 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 3 4 4 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 4 0 0 0 0 0 0 0 1
1 2 2 0 3 3 3 4 4 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 0 3 3 3 4 4 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 0 3 3 3 4 4 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 4 0 0 0 0 0 0 0 1
1 2 2 3 3 0 3 4 4 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 0 3 4 4 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 0 3 4 4 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 4 0 0 0 0 0 0 0 1
1 2 2 3 3 3 3 0 9 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 3 0 9 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 3 0 9 4 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 0 0 0 0 0 0 0 9 0 0 0 0 0 0 0 0 0 0 0 0 4 4 0 0 0 0 0 0 0 1
1 2 2 3 3 3 3 9 9 0 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 3 9 9 0 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 3 9 4 0 4 5 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 0 0 0 0 0 0 9 0 0 0 0 0 0 0 0 0 0 0 0 0 4 4 0 0 0 0 0 0 0 1
1 2 2 3 3 3 3 9 4 4 4 0 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 3 9 4 4 4 0 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 9 9 4 4 4 0 5 5 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 0 0 0 0 0 9 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 4 0 0 0 0 0 0 0 1
1 2 2 3 3 3 9 4 4 4 4 5 5 0 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 9 4 4 4 4 5 5 0 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 9 4 4 4 4 5 5 0 6 7 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 0 0 0 9 9 9 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 4 0 0 0 0 0 0 0 1
1 2 2 3 9 9 9 4 4 4 4 5 5 5 6 0 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 9 9 9 4 4 4 4 5 5 5 6 0 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 2 2 3 3 3 3 4 4 4 4 5 5 5 6 0 8 8 8 0 0 0 0 0 0 1 2 3 0 0 1
1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 4 0 0 0 0 0 0 0 1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 )

#tileink
#sprtile

#xcam 0.0
#ycam 0.0

#wtilemap 31
#htilemap 33

#wcam 20
#hcam 16

#xini
#yini

#xlim
#ylim

:drawt | dib --
	0? ( drop ; )
	xini yini sprTile ssprite
	;

:drawm
	xcam 11 >> $1f and neg 'xini !
	ycam 11 >> $1f and neg 'yini !
	'testmap
	ycam 16 >> wtilemap * xcam 16 >> + +

	hcam ( 1? 1 -
		wcam ( 1? 1 -
			rot c@+ drawt
			rot rot
			32 'xini +!
			) drop
		swap wtilemap wcam - + swap

		xcam 11 >> $1f and neg 'xini !
		32 'yini +!
		) 2drop ;


#tileini
:drawpaleta
	'testmap

	;



#imodes 'i_draw 'i_eye 'i_star 'i_pencil 'i_tool 0
#nmode

:main
	cls
	drawm

	home gui
	"print " print cr
	sp 'nmode 'imodes ibtnmode
	key
	>esc< =? ( exit )
	<up> =? ( -0.2 ycam + 0.0 max 'ycam ! )
	<dn> =? ( 0.2 ycam + ylim min 'ycam ! )
	<le> =? ( -0.2 xcam + 0.0 max 'xcam ! )
	<ri> =? ( 0.2 xcam + xlim min 'xcam ! )
	drop
	acursor
	;

:inimem
	mark
	cls home "cargando..." print redraw

	32 32
	"media/img/open_tileset.old.png"
	loadimg tileSheet 'sprtile !


	sw 32 / 1 + 'wcam !
	sh 32 / 2 + 'hcam !
	wtilemap wcam - 16 << 'xlim !
	htilemap hcam - 16 << 'ylim !
	;

: inimem 'main onShow ;